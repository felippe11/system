<!DOCTYPE html>
<html class="light" lang="pt-BR">

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <title>AppFiber - Cadastro</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&amp;display=swap"
    rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&amp;display=swap"
    rel="stylesheet" />
  <link
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
    rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <script id="tailwind-config">
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            "primary": "#1E88E5",
            "primary-dark": "#1565C0",
            "secondary": "#0f4c81",
            "background-light": "#ffffff",
            "background-alt": "#f8f9fa",
            "background-input": "#F7F9FC",
            "background-dark": "#111a21",
            "text-main": "#0e151b",
            "text-sub": "#4e7597"
          },
          fontFamily: {
            "display": ["Montserrat", "Inter", "sans-serif"],
            "body": ["Inter", "sans-serif"]
          },
          borderRadius: { "DEFAULT": "0.5rem", "lg": "1rem", "xl": "1.5rem", "2xl": "2rem", "full": "9999px" },
          boxShadow: {
            'soft': '0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03)',
            'glow': '0 0 15px rgba(30, 136, 229, 0.3)',
          }
        },
      },
    }
  </script>
  <style>
    .glass-panel {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .custom-scrollbar::-webkit-scrollbar {
      width: 4px;
    }

    .custom-scrollbar::-webkit-scrollbar-track {
      background: #f1f1f1;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb {
      background: #cbd5e1;
      border-radius: 4px;
    }
  </style>
</head>

<body
  class="bg-background-light font-body antialiased text-text-main min-h-screen flex flex-col lg:flex-row lg:h-screen lg:overflow-hidden">

  <!-- Mobile Header / Desktop Left Side -->
  <div
    class="relative w-full min-h-[35vh] shrink-0 bg-gray-900 overflow-hidden flex items-center justify-center lg:h-full lg:w-1/2">
    <div class="absolute inset-0 z-0 bg-cover bg-center transition-transform duration-1000 lg:hover:scale-105"
      style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuDQYLmUAOCE_txZisDRfP4CJAgrprdPXAWZnj5zb_8EHfU_J9zeRXwyP0i5djDulyJbhaiF8gjkR4I90QbMFh658A5ORvrRlOE7Vjcoo0LrxHZF5P2O0udCAjiaZxCLj7lyfj1Su9iLLz3BUY7lsRpWtH5rdX5g-IRdKbnjPqmLdBfTJAF2sC-mnJTZMrEtmokX0_0O0epFBK8JbdUKWOhA2bOhhwEVSk2Bs9ZiAfoJUi6fDp8AaJa3CxUTkd9smafN6U4VVPCtm14");'>
      <div class="absolute inset-0 bg-primary/80 mix-blend-multiply"></div>
      <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/40 to-transparent"></div>
    </div>

    <!-- Decoration Circles -->
    <div
      class="absolute top-[-20%] left-[-10%] size-24 lg:top-10 lg:left-10 lg:size-20 border border-white/10 rounded-full blur-xl">
    </div>
    <div
      class="absolute bottom-[-20%] right-[-10%] size-40 lg:bottom-20 lg:right-20 lg:size-32 bg-blue-400/20 rounded-full blur-2xl">
    </div>

    <!-- Content -->
    <div
      class="relative z-10 flex flex-col items-center justify-center text-center px-6 pt-4 pb-10 lg:p-12 lg:max-w-xl">
      <div class="mb-3 p-3 rounded-2xl glass-panel shadow-glow lg:mb-8 lg:p-4">
        <span class="material-symbols-outlined !text-[40px] lg:!text-[64px] text-white">hub</span>
      </div>
      <h2 class="font-display text-2xl font-bold text-white tracking-tight mb-2 lg:text-4xl lg:mb-4">AppFiber</h2>
      <div class="h-0.5 w-12 bg-white/30 rounded-full mb-3 lg:h-1 lg:w-20 lg:mb-6"></div>
      <p
        class="text-sm font-light leading-snug text-white/90 font-display max-w-[250px] lg:text-2xl lg:max-w-none lg:leading-relaxed">
        Sistema Integrado de <br class="hidden lg:block" />Gerenciamento de Eventos
      </p>
    </div>
  </div>

  <!-- Mobile Form Container / Desktop Right Side -->
  <div
    class="flex-1 bg-white relative rounded-t-[2rem] -mt-6 z-20 px-6 pt-8 pb-8 shadow-[0_-4px_20px_-4px_rgba(0,0,0,0.1)] lg:mt-0 lg:rounded-none lg:shadow-none lg:h-full lg:w-1/2 lg:flex lg:items-center lg:justify-center lg:p-12 lg:overflow-y-auto lg:custom-scrollbar">

    <!-- Back Button -->
    <div class="mb-6 lg:absolute lg:top-10 lg:left-10 lg:mb-0 lg:z-20">
      <a class="flex items-center text-gray-400 hover:text-primary transition-colors group w-fit"
        href="javascript:history.back()">
        <span
          class="material-symbols-outlined text-[24px] group-hover:-translate-x-1 transition-transform">arrow_back</span>
        <span class="ml-2 text-sm font-medium">Voltar</span>
      </a>
    </div>

    <div class="w-full max-w-lg mx-auto lg:mt-0">
      <!-- Mobile Branding Hidden on Desktop -->
      <!-- No extra branding needed here as per design -->

      <div class="mb-6 lg:mb-8 lg:text-left text-center">
        <h1 class="font-display text-2xl font-bold text-gray-900 tracking-tight lg:text-3xl">Cadastro de Cliente</h1>
        <p class="mt-2 text-sm text-text-sub leading-relaxed">Preencha as informações abaixo para criar uma conta</p>
      </div>

      <!-- Flash Messages -->
      <div class="mb-6">
        {% include 'partials/flash_messages.html' %}
      </div>

      <form action="{{ url_for('auth_routes.cadastrar_cliente_publico') }}" method="POST" class="space-y-5">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        {{ form.hidden_tag() }}

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1" for="name">Nome Completo</label>
          <div class="relative rounded-lg shadow-sm group">
            <div class="absolute inset-y-0 left-0 pl-3.5 flex items-center pointer-events-none">
              <span
                class="material-symbols-outlined text-gray-400 text-[20px] group-focus-within:text-primary transition-colors">person</span>
            </div>
            <input
              class="block w-full pl-11 pr-3 py-3 bg-background-input border-gray-200 rounded-lg text-gray-900 placeholder-gray-400 focus:ring-primary focus:border-primary text-base transition-all focus:bg-white hover:border-gray-300 outline-none focus:ring-1 sm:text-sm"
              id="nome" name="nome" placeholder="Ex: João da Silva" required="" type="text" />
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1" for="email">E-mail</label>
          <div class="relative rounded-lg shadow-sm group">
            <div class="absolute inset-y-0 left-0 pl-3.5 flex items-center pointer-events-none">
              <span
                class="material-symbols-outlined text-gray-400 text-[20px] group-focus-within:text-primary transition-colors">mail</span>
            </div>
            <input
              class="block w-full pl-11 pr-3 py-3 bg-background-input border-gray-200 rounded-lg text-gray-900 placeholder-gray-400 focus:ring-primary focus:border-primary text-base transition-all focus:bg-white hover:border-gray-300 outline-none focus:ring-1 sm:text-sm"
              id="email" name="email" placeholder="seu@email.com" required="" type="email" />
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1" for="password">Senha</label>
          <div class="relative rounded-lg shadow-sm group">
            <div class="absolute inset-y-0 left-0 pl-3.5 flex items-center pointer-events-none">
              <span
                class="material-symbols-outlined text-gray-400 text-[20px] group-focus-within:text-primary transition-colors">shield_lock</span>
            </div>
            <input
              class="block w-full pl-11 pr-10 py-3 bg-background-input border-gray-200 rounded-lg text-gray-900 placeholder-gray-400 focus:ring-primary focus:border-primary text-base transition-all focus:bg-white hover:border-gray-300 outline-none focus:ring-1 sm:text-sm"
              id="senha" name="senha" placeholder="••••••••" required="" type="password" />
            <button
              class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600 focus:outline-none cursor-pointer"
              type="button" id="togglePassword">
              <span class="material-symbols-outlined text-[20px]">visibility_off</span>
            </button>
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1" for="confirm_password">Confirmar Senha</label>
          <div class="relative rounded-lg shadow-sm group">
            <div class="absolute inset-y-0 left-0 pl-3.5 flex items-center pointer-events-none">
              <span
                class="material-symbols-outlined text-gray-400 text-[20px] group-focus-within:text-primary transition-colors">shield_lock</span>
            </div>
            <input
              class="block w-full pl-11 pr-10 py-3 bg-background-input border-gray-200 rounded-lg text-gray-900 placeholder-gray-400 focus:ring-primary focus:border-primary text-base transition-all focus:bg-white hover:border-gray-300 outline-none focus:ring-1 sm:text-sm"
              id="confirmacao_senha" name="confirmacao_senha" placeholder="••••••••" required="" type="password" />
            <button
              class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600 focus:outline-none cursor-pointer"
              type="button" id="toggleConfirmPassword">
              <span class="material-symbols-outlined text-[20px]">visibility_off</span>
            </button>
          </div>
        </div>

        <!-- reCAPTCHA Fields -->
        <input type="hidden" name="g-recaptcha-response" id="g-recaptcha-response">
        {% if form.errors.get('recaptcha', []) %}
        <div class="p-3 rounded-lg bg-red-50 text-red-700 text-sm mt-2 border border-red-100">
          {% for error in form.errors.get('recaptcha', []) %}
          {{ error }}
          {% endfor %}
        </div>
        {% endif %}

        <div class="pt-4">
          <button
            class="w-full flex justify-center items-center py-3.5 px-4 border border-transparent rounded-lg shadow-soft text-base font-bold text-white bg-primary hover:bg-primary-dark hover:shadow-glow focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary transition-all duration-300 transform active:scale-[0.98] gap-2"
            type="submit" id="submit-btn">
            <span class="material-symbols-outlined text-[20px]">add</span>
            Cadastrar
            <span class="animate-spin ml-2 hidden h-4 w-4 border-2 border-white rounded-full border-t-transparent"
              id="loading-spinner"></span>
          </button>
        </div>
      </form>

      <p class="mt-6 text-center text-sm text-gray-600">
        Já tem uma conta?
        <a class="font-bold text-primary hover:text-primary-dark transition-colors"
          href="{{ url_for('auth_routes.login') }}">Faça login</a>
      </p>

      <div class="mt-8 border-t border-gray-100 pt-6 text-center pb-4">
        <p class="text-xs text-gray-400">
          © 2025 AppFiber Inc. Todos os direitos reservados.
        </p>
      </div>
    </div>
  </div>

  <!-- reCAPTCHA Configuration & Scripts -->
  <script>
    console.log("Chave reCAPTCHA configurada:", {{ "true" if config.get('RECAPTCHA_PUBLIC_KEY') else "false" }});
  </script>
  <script src="https://www.google.com/recaptcha/api.js?render={{ config.get('RECAPTCHA_PUBLIC_KEY', '') }}"
    onerror="console.error('Falha ao carregar script do reCAPTCHA');"
    onload="console.log('Script reCAPTCHA carregado com sucesso');"></script>

  <script>
    // Toggle Password Visibility
    document.getElementById('togglePassword').addEventListener('click', function () {
      const passwordInput = document.getElementById('senha');
      const icon = this.querySelector('span');

      const isPassword = passwordInput.type === 'password';
      passwordInput.type = isPassword ? 'text' : 'password';
      icon.textContent = isPassword ? 'visibility' : 'visibility_off';
    });

    document.getElementById('toggleConfirmPassword').addEventListener('click', function () {
      const passwordInput = document.getElementById('confirmacao_senha');
      const icon = this.querySelector('span');

      const isPassword = passwordInput.type === 'password';
      passwordInput.type = isPassword ? 'text' : 'password';
      icon.textContent = isPassword ? 'visibility' : 'visibility_off';
    });

    // reCAPTCHA Script (Preserved logic)
    document.addEventListener('DOMContentLoaded', function () {
      const form = document.querySelector('form');
      const submitBtn = document.getElementById('submit-btn');
      const loadingSpinner = document.getElementById('loading-spinner');
      const recaptchaResponse = document.getElementById('g-recaptcha-response');
      const siteKey = '{{ config.get("RECAPTCHA_PUBLIC_KEY", "") }}';

      let tentativas = 0;

      function verificarRecaptcha() {
        return new Promise((resolve) => {
          const maxChecks = 20;
          let checks = 0;
          function check() {
            checks++;
            if (window.grecaptcha && window.grecaptcha.ready) {
              resolve(true);
              return;
            }
            if (checks >= maxChecks) {
              resolve(false);
              return;
            }
            setTimeout(check, 250);
          }
          check();
        });
      }

      function obterTokenRecaptcha(acao = "cadastro_cliente") {
        return new Promise((resolve, reject) => {
          if (!window.grecaptcha || !window.grecaptcha.ready) {
            reject(new Error("reCAPTCHA not ready"));
            return;
          }
          window.grecaptcha.ready(function () {
            window.grecaptcha.execute(siteKey, { action: acao })
              .then(function (token) {
                recaptchaResponse.value = token;
                resolve(token);
              })
              .catch(reject);
          });
        });
      }

      // Init Token
      verificarRecaptcha().then(disponivel => {
        if (disponivel) obtenirTokenRecaptcha("carregamento_pagina").catch(console.error);
      });

      form.addEventListener('submit', function (e) {
        e.preventDefault();
        submitBtn.disabled = true;
        loadingSpinner.classList.remove('hidden');

        if (recaptchaResponse.value && recaptchaResponse.value.length > 50) {
          form.submit();
          return;
        }

        verificarRecaptcha().then(disponivel => {
          if (!disponivel) {
            form.submit(); // Try anyway
            return;
          }
          obterTokenRecaptcha("envio_formulario")
            .then(() => {
              setTimeout(() => form.submit(), 100);
            })
            .catch(() => {
              form.submit(); // Try anyway
            });
        });
      });
    });
  </script>
</body>

</html>