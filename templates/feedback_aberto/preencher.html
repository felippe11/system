{% extends "base.html" %}

{% block title %}Feedback Aberto{% endblock %}

{% block content %}
<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-white">
          <h4 class="mb-0">Feedback Aberto</h4>
          <small class="text-muted">{{ dia.titulo or 'Feedback do dia' }} - {{ dia.data.strftime('%d/%m/%Y') }}</small>
        </div>
        <div class="card-body">
          <form method="POST">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <div class="mb-4">
              <h6 class="text-uppercase text-muted">Identificacao</h6>
              <div class="row g-2">
                <div class="col-md-6">
                  <input type="text" class="form-control" name="nome" placeholder="Nome" {% if dia.exigir_nome %}required{% endif %}>
                </div>
                <div class="col-md-6">
                  <input type="email" class="form-control" name="email" placeholder="Email" {% if dia.exigir_email %}required{% endif %}>
                </div>
                <div class="col-md-6">
                  <input type="text" class="form-control" name="telefone" placeholder="Telefone" {% if dia.exigir_telefone %}required{% endif %}>
                </div>
                <div class="col-md-6">
                  <input type="text" class="form-control" name="identificador" placeholder="Matricula / ID interno" {% if dia.exigir_identificador %}required{% endif %}>
                </div>
              </div>
            </div>
            {% for item in perguntas %}
              {% set pergunta = item.obj %}
              <div class="mb-4">
                <label class="form-label fw-semibold">{{ pergunta.titulo }}</label>
                {% if pergunta.descricao %}
                  <div class="text-muted small mb-2">{{ pergunta.descricao }}</div>
                {% endif %}
                {% if pergunta.tipo.value == 'texto_livre' %}
                  <textarea class="form-control" name="q_{{ pergunta.id }}" rows="3" {% if pergunta.obrigatoria %}required{% endif %}></textarea>
                {% elif pergunta.tipo.value == 'escala_numerica' %}
                  <input type="number" class="form-control" name="q_{{ pergunta.id }}" min="1" max="10" {% if pergunta.obrigatoria %}required{% endif %}>
                  <small class="text-muted">Informe uma nota de 1 a 10.</small>
                {% elif pergunta.tipo.value == 'multipla_escolha' %}
                  {% if item.opcoes %}
                    {% for opcao in item.opcoes %}
                      <div class="form-check">
                        <input class="form-check-input" type="radio" name="q_{{ pergunta.id }}" value="{{ opcao }}" {% if pergunta.obrigatoria %}required{% endif %}>
                        <label class="form-check-label">{{ opcao }}</label>
                      </div>
                    {% endfor %}
                  {% else %}
                    <input type="text" class="form-control" name="q_{{ pergunta.id }}" {% if pergunta.obrigatoria %}required{% endif %}>
                  {% endif %}
                {% elif pergunta.tipo.value == 'multipla_escolha_multipla' %}
                  {% if item.opcoes %}
                    {% for opcao in item.opcoes %}
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="q_{{ pergunta.id }}" value="{{ opcao }}">
                        <label class="form-check-label">{{ opcao }}</label>
                      </div>
                    {% endfor %}
                    {% if pergunta.obrigatoria %}
                      <small class="text-muted">Selecione pelo menos uma opcao.</small>
                    {% endif %}
                  {% else %}
                    <input type="text" class="form-control" name="q_{{ pergunta.id }}" {% if pergunta.obrigatoria %}required{% endif %}>
                  {% endif %}
                {% elif pergunta.tipo.value == 'sim_nao' %}
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="q_{{ pergunta.id }}" value="Sim" {% if pergunta.obrigatoria %}required{% endif %}>
                    <label class="form-check-label">Sim</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="q_{{ pergunta.id }}" value="Nao" {% if pergunta.obrigatoria %}required{% endif %}>
                    <label class="form-check-label">Nao</label>
                  </div>
                {% elif pergunta.tipo.value == 'email' %}
                  <input type="email" class="form-control" name="q_{{ pergunta.id }}" {% if pergunta.obrigatoria %}required{% endif %}>
                {% elif pergunta.tipo.value == 'telefone' %}
                  <input type="text" class="form-control" name="q_{{ pergunta.id }}" {% if pergunta.obrigatoria %}required{% endif %}>
                {% elif pergunta.tipo.value == 'data' %}
                  <input type="date" class="form-control" name="q_{{ pergunta.id }}" {% if pergunta.obrigatoria %}required{% endif %}>
                {% elif pergunta.tipo.value == 'numero' %}
                  <input type="number" class="form-control" name="q_{{ pergunta.id }}" {% if pergunta.obrigatoria %}required{% endif %}>
                {% endif %}
              </div>
            {% endfor %}
            <button class="btn btn-primary" type="submit">Enviar feedback</button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
