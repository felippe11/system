{% extends "base.html" %}
{% block title %}Configurações de Submissão{% endblock %}

{% block content %}
<div class="container py-4" id="configSubmissao"
     data-url-config-cliente-atual="{{ url_for('config_cliente_routes.configuracao_cliente_atual') }}"
     data-revisao-configs='{{ revisao_configs|tojson }}'
     data-min-rev="{{ config_cliente.num_revisores_min if config_cliente else 1 }}"
     data-max-rev="{{ config_cliente.num_revisores_max if config_cliente else 2 }}">
  <h1 class="h3 mb-4"><i class="bi bi-journal-text me-2"></i>Submissões e Revisão</h1>
  <div class="card border-info border-top border-4 shadow-sm mb-4">
    <div class="card-header bg-info text-white">
      <div class="d-flex align-items-center">
        <i class="bi bi-journal-text me-2 fs-5"></i>
        <h5 class="fw-bold mb-0">Submissões e Revisão</h5>

      </div>
    </div>
    <div class="card-body">
      <div class="config-item d-flex justify-content-between align-items-center p-3 border-bottom form-group">
        <div>
          <h6 class="mb-0 fw-semibold d-flex align-items-center">
            <i class="bi bi-upload text-primary me-2"></i>
            Submissão de Trabalhos
          </h6>
          <p class="text-muted small mb-1">
            Permite que participantes submetam trabalhos
          </p>
          <small class="form-text text-muted">Desativar impede novos envios.</small>
        </div>
        <button type="button"
                id="btnToggleSubmissao"
                class="btn btn-padrao btn-toggle btn-{{ 'success' if config_cliente and config_cliente.habilitar_submissao_trabalhos else 'danger' }}"
                data-toggle-url="{{ url_for('config_cliente_routes.toggle_submissao_trabalhos_cliente') }}">
          <i class="bi bi-{{ 'check-circle-fill' if config_cliente and config_cliente.habilitar_submissao_trabalhos else 'x-circle-fill' }}"></i>
          {{ 'Ativo' if config_cliente and config_cliente.habilitar_submissao_trabalhos else 'Desativado' }}
        </button>
      </div>
      <div class="config-item p-3 border-bottom form-group">
        <label for="inputAllowedFiles" class="form-label">Tipos de Arquivo Permitidos</label>
        <input type="text" id="inputAllowedFiles" class="form-control w-auto" value="{{ config_cliente.allowed_file_types }}" data-update-url="{{ url_for('config_cliente_routes.set_allowed_file_types') }}">
        <small class="form-text text-muted">Separe extensões por vírgula.</small>
      </div>
      <div class="config-item p-3 border-bottom form-group">
        <label for="selectFormularioSubmissao" class="form-label">Formulário de Submissão</label>
        <select id="selectFormularioSubmissao" class="form-select w-auto" data-update-url="{{ url_for('config_cliente_routes.set_formulario_submissao') }}">
          <option value="" {% if not config_cliente.formulario_submissao_id %}selected{% endif %}>Padrão</option>
          {% for formulario in formularios %}
          <option value="{{ formulario.id }}" {% if config_cliente.formulario_submissao_id == formulario.id %}selected{% endif %}>{{ formulario.nome }}</option>
          {% endfor %}
        </select>
        <small class="form-text text-muted">Define quais campos os autores preenchem.</small>
      </div>
      <div class="config-item p-3 border-bottom form-group">
        <label for="selectReviewModel" class="form-label">Modelo de Revisão</label>
        <select id="selectReviewModel" class="form-select w-auto" data-update-url="{{ url_for('config_cliente_routes.set_review_model') }}">
          <option value="single" {% if config_cliente.review_model == 'single' %}selected{% endif %}>Single-blind</option>
          <option value="double" {% if config_cliente.review_model == 'double' %}selected{% endif %}>Double-blind</option>
        </select>
        <small class="form-text text-muted">Escolha o nível de anonimato da revisão.</small>
      </div>
        <div class="config-item p-3 form-group">
          <p class="small text-muted mb-3">Ajuste limites e prazos para a revisão.</p>
          <div class="row g-2 align-items-end">
          <div class="col">
            <label class="form-label mb-0">Mínimo Revisores</label>
            <input type="number" min="1" class="form-control" id="inputRevisoresMin" value="{{ config_cliente.num_revisores_min }}" data-update-url="{{ url_for('config_cliente_routes.set_num_revisores_min') }}">
            <small class="form-text text-muted">Quantidade mínima por trabalho.</small>
          </div>
          <div class="col">
            <label class="form-label mb-0">Máximo Revisores</label>
            <input type="number" min="1" class="form-control" id="inputRevisoresMax" value="{{ config_cliente.num_revisores_max }}" data-update-url="{{ url_for('config_cliente_routes.set_num_revisores_max') }}">
            <small class="form-text text-muted">Limite máximo por trabalho.</small>
          </div>
          <div class="col">
            <label class="form-label mb-0">Prazo (dias)</label>
            <input type="number" min="1" class="form-control" id="inputPrazoParecer" value="{{ config_cliente.prazo_parecer_dias }}" data-update-url="{{ url_for('config_cliente_routes.set_prazo_parecer_dias') }}">
            <small class="form-text text-muted">Tempo padrão para entrega do parecer.</small>
          </div>
          <div class="col">
            <label class="form-label mb-0">Máx. Trab./Revisor</label>
            <input type="number" min="1" class="form-control" id="inputMaxTrabalhosRevisor" value="{{ config_cliente.max_trabalhos_por_revisor }}" data-update-url="{{ url_for('config_cliente_routes.set_max_trabalhos_revisor') }}">
            <small class="form-text text-muted">Total de trabalhos por avaliador.</small>
          </div>
        </div>

        {% if eventos %}
        <div class="mt-3 form-group">
          <h6 class="mb-2 fw-semibold">Submissão por Evento</h6>
          <p class="small text-muted mb-2">Gerencie a abertura de submissões por evento.</p>
          {% for evento in eventos %}
          <div class="config-item d-flex justify-content-between align-items-center p-2 border-bottom">
            <span>{{ evento.nome }}</span>
            <button type="button"
                    class="btn btn-padrao btn-toggle btn-{{ 'success' if evento.submissao_aberta else 'danger' }}"
                    data-toggle-url="{{ url_for('config_cliente_routes.toggle_submissao_evento', evento_id=evento.id) }}"
                    data-label="{{ evento.nome }}">
              {{ 'Ativo' if evento.submissao_aberta else 'Desativado' }}
            </button>
          </div>
          {% endfor %}
        </div>
        <div class="mt-3 form-group">
          <h6 class="mb-2 fw-semibold">Configuração de Revisão por Evento</h6>
          <p class="small text-muted mb-2">Defina etapas e prazos específicos de revisão.</p>
          <form id="formRevisaoConfig" class="row g-2 align-items-end">
            <div class="col">
              <label class="form-label mb-0">Evento</label>
              <select id="selectEventoRevisao" class="form-select">
                {% for evento in eventos %}
                <option value="{{ evento.id }}">{{ evento.nome }}</option>
                {% endfor %}
              </select>
              <small class="form-text text-muted">Evento alvo da configuração.</small>
            </div>
            <div class="col">
              <label class="form-label mb-0">Nº Revisores</label>
              <input type="number" min="1" class="form-control" id="inputNumeroRevisores">
              <small class="form-text text-muted">Número de avaliadores desejado.</small>
            </div>
            <div class="col">
              <label class="form-label mb-0">Prazo Revisão</label>
              <input type="date" class="form-control" id="inputPrazoRevisao">
              <small class="form-text text-muted">Data limite para as avaliações.</small>
            </div>
            <div class="col">
              <label class="form-label mb-0">Modelo Blind</label>
              <select id="selectModeloBlind" class="form-select">
                <option value="single">Single-blind</option>
                <option value="double">Double-blind</option>
                <option value="open">Open review</option>
              </select>
              <small class="form-text text-muted">Modelo de anonimato.</small>
            </div>
            <div class="col-12 col-sm-2">
              <button type="submit" class="btn btn-primary w-100 mt-2 mt-sm-0">Salvar</button>
            </div>
          </form>
        </div>
        {% endif %}

      </div>
    </div>
    </div>

  <div id="mapearColunasModal"></div>
  <script type="text/template" id="mapearColunasTemplate">
    {% include 'trabalho/selecionar_colunas_trabalho.html' %}
  </script>

{% endblock %}



{% block scripts %}

{{ super() }}
<script src="{{ url_for('static', filename='js/config_revisao.js') }}"></script>
<script src="{{ url_for('static', filename='js/dashboard_cliente.js') }}"></script>
<script src="{{ url_for('static', filename='js/config_submissao.js') }}"></script>
{% endblock %}

